<!DOCTYPE html>
{% load static %}
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Project Detail</title>
  
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="{% static 'user/project_details.css' %}">
  <script>
    const SESSION_USER_ID = "{{ request.session.user_id }}";
    const csrf_token="{{ csrf_token }}"
    
  </script>
  <script src="{% static 'user/js/project_details.js' %}"></script>
</head>

<body>
  <div class="main-content">
    <div class="header">
      <div class="header-left">
        <div class="logo-container">
          <img src="https://d1s24u4ln0wd0i.cloudfront.net/website/new_ecom_asset/logo1.webp" alt="Medkart Logo" />
        </div>
        <h2>{{ project.title }}</h2>
      </div>
      <div class="header-right">
        <div class="user-info">
          <i class="fa fa-user-circle"></i>
          <div class="user-text">
            <span class="username">{{ request.session.username }}</span>
            <span class="fullname">({{ request.session.name }})</span>
          </div>
        </div>
        <form method="post" action="/logout" style="display: inline;">
          {% csrf_token %}
          <button type="submit" class="power-btn" title="Logout">
            <i class="fa fa-power-off"></i>
          </button>
        </form>
      </div>
    </div>

    <div class="content">
      <div class="project-layout">
        <div class="col-projects">
          <div class="col-header">Projects</div>
          <div class="project-list-wrapper">
            {% for p in projects %}
            <a href="?project_id={{ p.id }}" class="project-item {% if p.id == project.id %}active{% endif %}">
              <div class="project-item-name">{{ p.title }}</div>
              <div class="project-item-desc">{{ p.detail }}</div>
            </a>
            {% endfor %}
          </div>
        </div>

        <div class="col-details">
          <div class="detail-card" id="projectInfo" data-project-id="{{ project.id }}">
            <h3>Project Details</h3>
            <p><strong>Title:</strong> {{ project.title }}</p>
            <p><strong>Description:</strong> {{ project.detail }}</p>
          </div>

          <div class="users-card">
            <h3>Assigned Users</h3>
            {% if users %} {% for user in users %}
            <div class="user-row">
              <div class="user-avatar">
                {{ user.username|slice:":1"|upper }}
              </div>
              <div class="user-meta">
                <span class="user-name">{{ user.username }}</span>
                <span class="user-email">{{ user.email }}</span>
              </div>
            </div>
            {% endfor %} {% else %}
            <div class="empty">No users assigned</div>
            {% endif %}
          </div>
        </div>

        <div class="col-tasks">
          <div class="tasks-header">
            <h3>Tasks</h3>
            <div class="task-filters" style="display: flex; gap: 10px; margin-left: auto; margin-right: 10px;">
              <select id="searchType">
                <option value="title">Title</option>
                <option value="priority">Priority</option>
                <option value="status">Status</option>
              </select>
              <input type="text" id="searchInput" placeholder="Search title..." />
              <select id="priorityFilter" class="filter-hidden">
                <option value="">All</option>
                <option value="high">High</option>
                <option value="medium">Medium</option>
                <option value="low">Low</option>
              </select>
              <select id="statusFilter" class="filter-hidden">
                <option value="">All</option>
                <option value="Todo">Todo</option>
                <option value="In Progress">In Progress</option>
                <option value="Under Review">Under Review</option>
                <option value="Done">Done</option>
              </select>
            </div>
            <div style="display: flex; gap: 10px">
              <button id="myTasksBtn" class="btn-sm">My Tasks</button>
              <button id="allTasksBtn" class="btn-sm">All Tasks</button>
              <button class="add-task-btn" title="Add Task">+</button>
            </div>
          </div>
          <div class="tasks-body">
            <table class="task-table">
              <thead>
                <tr>
                  <th>Title</th>
                  <th>Priority</th>
                  <th>Status</th>
                  <th>Assigned To</th>
                  <th>Due Date</th>
                  <th>Created by</th>
                  <th>Updated by</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="taskTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="taskModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>

      <h3>Add Task</h3>

      <form id="taskForm">
        <input type="hidden" name="project_id" value="{{ project.id }}" />

        <div class="form-group">
          <label>Title</label>
          <input type="text" name="title" required />
        </div>

        <div class="form-group">
          <label>Description</label>
          <textarea name="description" rows="3" required></textarea>
        </div>

        <div class="form-group">
          <label>Priority</label>
          <select name="priority" required>
            <option value="high">High</option>
            <option value="medium">Medium</option>
            <option value="low">Low</option>
          </select>
        </div>

        <div class="form-group">
          <label>Due Date</label>
          <input type="date" name="due_date" required />
        </div>

        <div class="form-group">
          <label>Assign To</label>
          <select name="assigned_to" required>
            {% for user in users %}
            <option value="{{ user.id }}">{{ user.username }}</option>
            {% endfor %}
          </select>
        </div>

        <button type="submit" class="submit-btn">Create Task</button>
      </form>
    </div>
  </div>

  <div id="editTaskModal" class="modal">
    <div class="modal-content">
      <span class="close edit-close">&times;</span>

      <h3>Edit Task</h3>

      <form id="editTaskForm">
        <input type="hidden" name="task_id" />

        <div class="form-group">
          <label>Title</label>
          <input type="text" name="title" required />
        </div>

        <div class="form-group">
          <label>Description</label>
          <textarea name="description" rows="3" required></textarea>
        </div>

        <div class="form-group">
          <label>Priority</label>
          <select name="priority" required>
            <option value="high">High</option>
            <option value="medium">Medium</option>
            <option value="low">Low</option>
          </select>
        </div>

        <div class="form-group">
          <label>Due Date</label>
          <input type="date" name="due_date" required />
        </div>

        <div class="form-group">
          <label>Assign To</label>
          <select name="assigned_to">
            {% for user in users %}
            <option value="{{ user.id }}">{{ user.username }}</option>
            {% endfor %}
          </select>
        </div>

        <button type="submit" class="submit-btn">Save Changes</button>
      </form>
    </div>
  </div>

  <div class="workflow-overlay" id="overlay"></div>

  <div class="workflow-popup" id="popup">
    <button class="workflow-close-btn" id="closeBtn">&times;</button>
    <h2>Workflow Status</h2>

    <div class="workflow-status-container">
      <div class="workflow-status-box active" id="status0">
        <div class="workflow-status-circle">To-Do</div>
      </div>
      <div class="workflow-status-box" id="status1">
        <div class="workflow-status-circle">In-Progress</div>
      </div>
      <div class="workflow-status-box" id="status2">
        <div class="workflow-status-circle">Under-Review</div>
      </div>
      <div class="workflow-status-box" id="status3">
        <div class="workflow-status-circle">Done</div>
      </div>
    </div>

    <div class="button-container">
      <button class="workflow-next-btn" id="nextBtn">Update</button>
    </div>
  </div>

  <div id="commentsModal" class="modal">
    <div class="modal-content comment-box">
      <div class="modal-header">
        <h3>Task Comments</h3>
        <span class="close-comment">&times;</span>
      </div>

      <div id="commentsList" class="comments-container">
        <div class="empty-comments">No comments yet</div>
      </div>

      <div class="add-comment-box">
        <textarea id="newComment" placeholder="Write a comment..."></textarea>
        <button id="sendCommentBtn" class="send-btn">
          <i class="send-icon"></i>
        </button>
      </div>
    </div>
  </div>

  
</body>

</html>